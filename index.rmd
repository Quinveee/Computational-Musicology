---
title: "Spotify Analysis"
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    source_code: "https://github.com/Quinveee/Computational-Musicology"
    css: style.css
    theme:
      version: 4
      bootswatch: minty
    vertical_layout: scroll
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidytext)
library(tidyverse)
library(spotifyr)
library(flexdashboard)
library(plotly)
library(compmus)

corpus <- get_playlist_audio_features("", "75LhP6wXfee0eYHuW28nkw")
corpus |>
  summarise(
    mean_speechiness = mean(speechiness),
    mean_acousticness = mean(acousticness),
    mean_liveness = mean(liveness),
    sd_speechiness = sd(speechiness),
    sd_acousticness = sd(acousticness),
    sd_liveness = sd(liveness),
    median_speechiness = median(speechiness),
    median_acousticness = median(acousticness),
    median_liveness = median(liveness),
    mad_speechiness = mad(speechiness),
    mad_acousticness = mad(acousticness),
    mad_liveness = mad(liveness)
  )
```

# Corpus

## Column 

### Corpus Description

The corpus for this musical analysis consists of a collection of albums (see Appendix) that I chose based on my personal interest. I chose albums specifically, as it is the form in which I consume most of my music, but it will also ensure that the overlap in musical genres is more consistent between songs. This does however mean that the analysis will focus more on the difference between the albums as opposed to differences between individual songs. As for the corpus, it consists of a variety of genres including rock, pop, post-rock, ambient, shoegaze, neo-psychedelia, hip-hop. At first glance it might seem as if there is little overlap between the album’s genres, however, most can be categorized in either rock, ambient, pop, or hip-hop. Though there are some album’s that can be considered atypical for these categories, for example LONG SEASON by the Fishmans. This album consists of a single 35-minute song and incorporates a variety of genres into one. Another example is REGRET WHEN IT WAS LOST by death’s dynamic shroud which at points blurs the line between surrealism and music. Or F# A# ∞ by Godspeed You! Black Emperor, an album containing multiple monologues throughout the song creating an eerie vibe. I chose to incorporate these albums not only because they are some of my personal favorites but also for their uniqueness, which should hopefully lead to a more interesting analysis. The corpus contains many more such examples, which I will cover further in the analysis. However, most of the corpus consists of more typical genre representative albums, for example the albums made by; Radiohead, No Party For Coa Dong, tricot, Pink Floyd, Polyphia and Panchiko, are more typical to rock. So, all in all, the corpus consists of a combination of typical and atypical albums which should lead to an interesting analysis of the distinctions an overlap between genres and individual albums/songs.


# Global Analysis {data-navmenu=Analysis}

## Column {data-width="350"}

### Analysis over the entire range of songs

#### Plot A

Plot 1 shows a comparrison of the liveness, acousticness and the speechness of each individual song. What is interesting about the plot is that there appears to be verry little acousticness and speechness. This is relativally odd as many of the songs should contain speech, furthermore, the liveness seems rather low, possebly due to the amount of ambient music, but what is then even more odd is the fact that many of the songs with the highest liveness are ambient songs (this may be due to Spotify's algorithm not fully comprehending ambient music). The acousticness on the other hand seems all over the place, likely due to the fast differences in genres.

#### Plot B

Plot 2 shows the mean energy levels of all albums in decending order. What is interesting about this plot is that the albums seems to contain nearly the entire range of the energy spectrum, all the way from A I A: Alien Observer at a level of around 0.13 to World is Yours at almost 1, with an overall mean of around 0.6.

## Column {data-width="650"}

### Plot A

```{r, echo=FALSE}
corpus_with_title <- 
  corpus %>%
  mutate(title = paste(track.album.name, " - ", track.name))


multi_plot_1 <- ggplot(corpus_with_title, aes(x = liveness, y = acousticness, color = speechiness, size = speechiness, label = title)) +
  geom_jitter(alpha = 0.7, width = 0.1) +
  theme_classic() + 
  scale_color_viridis_c() + 
  guides(size = "none") +
  labs(title = "Comparison of Liveness, Acousticness and Speechness",
       subtitle = "The plot consists of the liveness, acousticness and speechness of all individual songs"
  ) + 
  theme(
    legend.position = "Bottom"
  )

ggplotly(multi_plot_1, tooltip = c("x", "y", "label", "size"))
```

### Plot B

```{r, echo=FALSE}
corpus_energy <- corpus %>% 
  group_by(track.album.name) %>%
  summarize(album_energy=mean(energy))

global_mean <- mean(corpus$energy)

energy_plot_1 <- ggplot(corpus_energy, aes(x = album_energy, y = reorder(track.album.name, album_energy), color = album_energy)) +
  geom_point(size = 3) +
  geom_vline(xintercept = global_mean, color = "grey40", linetype = 3) +
  geom_segment(aes(xend = 0, yend = track.album.name), size = 2) + 
  theme_classic() +
  theme(legend.position = 'none') +
  labs(x = "Album's Mean Energy",
       y = "Album",
       title = "Albums ranked on their mean energy level") + 
  annotate(
    "text",
    x = global_mean + 0.06, y = 8,
    label = "Global\nmean",
    vjust = 1, size = 3, color = "grey40"
  ) +
  theme(
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.title = element_blank(),
    panel.grid = element_blank(),
    plot.subtitle = element_text(size = 9)
  )
  

ggplotly(energy_plot_1)

```

# Individual Songs {data-navmenu=Analysis data-orientation=rows}

## Row

### sdkjkljds

sdkljfl;asjd;lkfj;laskjdf


## Column {.tabset .tabset-fade}

### Chroma 1

```{r, echo=FALSE, fig.width=15, fig.height=4}
rainseason <-
  get_tidy_audio_analysis("08b1bCjsKjMzhjBm0qhkof") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

rainseason |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()

```

### Chroma 2

```{r, echo=FALSE, fig.width=15, fig.height=4}
fellinlove <-
  get_tidy_audio_analysis("7qgVP1RmTu8Kg3MGsIl87D") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

fellinlove |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()

```

### Chroma 3

```{r, echo=FALSE, fig.width=15, fig.height=4}
# Hopelessness 5gTGFOB8RIihsPxfIC0OtH
# Slowdeath 1BeXGCZcCtfnW6stIaat1M
# Romantic Menory 1 624OIP4GiJDuDzlnm6j3Eo
# Daikaze... 52jaRS6n9DXbgf0Hd1sxlh
# No Suprises 10nyNJ6zNy2YVYLrcwLccB
# shine on you crazy diamonds 32dnKMni3I3gwUbWp4mi45
# small ... kid 6hUeV1owXYwGT0iKQH5hg4
# roygbiv 5Hf2h59YLInKlic7ooWZVd
# ... natsu 2dFUtZtpWydAU4QMmUOK47
# Building stream... nor. 6K8J4txeZp5anMIE0srVqr
# Building stream... alter. 6YluFLtLKCjW5hajXJj5oC
# building a better world [-1] 6wemF0lNDZUnZE4DE2BD0t

slowdeath <-
  get_tidy_audio_analysis("6wemF0lNDZUnZE4DE2BD0t") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

slowdeath |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()

```

## Row

### sdkjkljds

sdkljfl;asjd;lkfj;laskjdf


### Dynamic Time Wrapping

```{r, echo=FALSE, fig.width=20, fig.height=20}
buildingstream_nor <-
  get_tidy_audio_analysis("6K8J4txeZp5anMIE0srVqr") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

buildingstream_alt <-
  get_tidy_audio_analysis("6YluFLtLKCjW5hajXJj5oC") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

compmus_long_distance(
  buildingstream_nor |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  buildingstream_alt |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "euclidean"
) |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "Building Stream With A Grain of Salt", y = "Building Stream With A Grain of Salt Alternate version") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)

```

# Findings

## Column

### Nothing Here Yet

#### :)
